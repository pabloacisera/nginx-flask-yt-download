services:
  # ====================================
  # BACKEND: Flask API
  # ====================================
  - type: web
    name: flask-api
    runtime: docker
    dockerfilePath: ./api/Dockerfile
    dockerContext: ./api
    envVars:
      - key: FLASK_ENV
        value: production
      - key: DEBUG
        value: false
      - key: DATABASE_URL
        sync: false # Render automáticamente inyectará el valor de la base de datos aquí
    healthCheckPath: /api/health
    plan: free

---

  # ====================================
  # FRONTEND: Nginx
  # ====================================
  - type: web
    name: nginx-frontend
    runtime: docker
    dockerfilePath: ./nginx/Dockerfile.prod
    dockerContext: ./nginx
    envVars:
      # CAMBIO CLAVE: Usamos el nombre de host interno de Render para que Nginx pueda encontrar la API.
      - key: BACKEND_URL
        value: http://flask-api.onrender.internal:5000 
    plan: free

---

# ====================================
# BASE DE DATOS
# ====================================
databases:
  - name: mi-app-db
    databaseName: prod_db
    plan: free