worker_processes 1;
events { worker_connections 1024; }

http {
Â  Â  includeÂ  Â  Â  Â mime.types;
Â  Â  default_typeÂ  application/octet-stream;
Â  Â  sendfile on;
Â  Â  keepalive_timeout 65;

    # ðŸ›‘ PASO 1: Agregar el resolver de Render y la bandera "valid"
    resolver 10.0.0.10 valid=30s;
    
    # ðŸ›‘ PASO 2: Definir el host de backend como una variable
    set $backend_host "http://flask-api.onrender.internal:5000";

Â  Â  server {
Â  Â  Â  Â  listen 80;
Â  Â  Â  Â  root /usr/share/nginx/html;
Â  Â  Â  Â  index index.html;

Â  Â  Â  Â  location / {
Â  Â  Â  Â  Â  Â  try_files $uri $uri/ /index.html;
Â  Â  Â  Â  }

Â  Â  Â  Â  # Proxy para API
Â  Â  Â  Â  location /api/ {
Â  Â  Â  Â  Â  Â  # ðŸ‘‡ REWRITE quita el /api/ antes de enviar al backend
Â  Â  Â  Â  Â  Â  rewrite ^/api/(.*) /$1 break;
Â  Â  Â  Â  Â  Â  
            # ðŸ›‘ PASO 3: Usar la variable en proxy_pass (SIN protocolo o puerto)
            # Nginx lo agregarÃ¡ automÃ¡ticamente si usas la variable.
Â  Â  Â  Â  Â  Â  proxy_pass $backend_host;
            
Â  Â  Â  Â  Â  Â  proxy_set_header Host $host;
Â  Â  Â  Â  Â  Â  proxy_set_header X-Real-IP $remote_addr;
Â  Â  Â  Â  Â  Â  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
Â  Â  Â  Â  Â  Â  proxy_set_header X-Forwarded-Proto $scheme;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  # Timeouts para procesamiento de audio
Â  Â  Â  Â  Â  Â  proxy_connect_timeout 300s;
Â  Â  Â  Â  Â  Â  proxy_send_timeout 300s;
Â  Â  Â  Â  Â  Â  proxy_read_timeout 300s;
Â  Â  Â  Â  }

Â  Â  Â  Â  location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
Â  Â  Â  Â  Â  Â  expires 1y;
Â  Â  Â  Â  Â  Â  add_header Cache-Control "public, immutable";
Â  Â  Â  Â  }
Â  Â  }
}